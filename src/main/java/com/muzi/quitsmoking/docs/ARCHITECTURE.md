# 戒烟助手系统架构说明文档

## 1. 系统概述

戒烟助手是一个帮助用户戒烟的移动应用后端系统，提供戒烟追踪、健康评估、社区互动等功能，帮助用户克服烟瘾，重获健康生活。

## 2. 技术栈

- **核心框架**：Spring Boot 3.x
- **ORM框架**：MyBatis-Plus
- **数据库**：MySQL 8.x
- **缓存**：Redis
- **权限认证**：JWT + Spring Security
- **API文档**：Swagger 3 (OpenAPI)
- **日志框架**：SLF4J + Logback
- **工具库**：Hutool、Lombok

## 3. 系统架构

### 3.1 整体架构

系统采用经典的三层架构设计：

1. **表现层（Controller）**：负责接收和处理HTTP请求，返回响应结果
2. **业务层（Service）**：负责业务逻辑处理
3. **数据访问层（Mapper）**：负责数据库操作

同时引入了DTO、VO对象进行数据传输，Entity对象映射数据库表，使系统层次更加清晰。

### 3.2 包结构说明

```
com.muzi.quitsmoking
├── annotation       # 自定义注解
├── aop             # AOP切面
├── common          # 通用组件
├── config          # 配置类
├── controller      # 控制器
├── exception       # 异常处理
├── interceptor     # 拦截器
├── mapper          # MyBatis Mapper接口
├── model           # 模型类
│   ├── constants   # 常量定义
│   ├── dto         # 数据传输对象
│   ├── entity      # 实体类
│   └── vo          # 视图对象
├── service         # 服务接口
│   └── impl        # 服务实现
└── utils           # 工具类
```

### 3.3 核心模块说明

#### 3.3.1 用户模块

- 用户注册、登录、登出
- 个人信息管理
- 用户认证与授权

#### 3.3.2 戒烟记录模块

- 戒烟天数计算与展示
- 吸烟欲望记录
- 戒烟目标管理

#### 3.3.3 健康评估模块

- 健康状态评估
- 健康改善时间线
- 健康收益计算

#### 3.3.4 社区互动模块

- 戒烟经验分享
- 互动评论
- 点赞收藏

#### 3.3.5 工具与资讯模块

- 戒烟小贴士
- 紧急求助功能
- 专业文章阅读

#### 3.3.6 成就与激励模块

- 成就系统
- 积分奖励
- 打卡系统

## 4. 数据库设计

系统使用MySQL数据库，主要包含以下核心表：

- **user**：用户信息表
- **smoking_record**：吸烟记录表
- **checkin**：打卡记录表
- **health_timeline**：健康时间线表
- **health_benefit**：健康收益表
- **achievement**：成就表
- **user_achievement**：用户成就关联表
- **article**：文章表
- **article_read**：文章阅读记录表
- **tool**：工具表
- **tool_usage**：工具使用记录表
- **emergency_help**：紧急求助记录表
- **community_post**：社区帖子表
- **comment**：评论表
- **like_record**：点赞记录表

## 5. 安全架构

### 5.1 认证机制

系统采用JWT（JSON Web Token）进行身份认证：

1. 用户登录后，服务器生成JWT令牌
2. 客户端请求时在Header中携带令牌
3. 服务器验证令牌有效性
4. 令牌过期后需要重新登录获取

### 5.2 授权机制

系统通过基于角色和权限的授权机制控制资源访问：

1. 用户拥有角色，如：普通用户、VIP用户、管理员
2. 角色拥有权限，如：发布帖子、管理用户
3. 资源访问通过权限控制

### 5.3 异常处理

系统采用统一的异常处理机制：

1. 自定义异常体系，包含基础异常、业务异常、系统异常
2. 通过全局异常处理器统一捕获和处理异常
3. 返回标准化的错误响应

## 6. 接口设计

系统接口遵循RESTful设计风格：

- 使用HTTP方法表示操作类型：GET（查询）、POST（创建）、PUT（更新）、DELETE（删除）
- 使用HTTP状态码表示操作结果
- 接口路径使用名词表示资源
- 接口响应统一使用JSON格式

所有接口响应均采用统一的响应格式：

```json
{
  "code": 0,          // 状态码，0表示成功，非0表示错误
  "message": "success", // 提示信息
  "data": {}          // 响应数据
}
```

## 7. 数据缓存策略

系统使用Redis进行数据缓存：

1. 热点数据缓存：文章、用户信息等
2. 计数器缓存：阅读量、点赞数等
3. 会话缓存：用户登录状态
4. 防重复提交缓存：表单提交、短信验证码等

缓存策略采用：
- 失效策略：定时失效 + 主动更新
- 淘汰策略：LRU（最近最少使用）
- 一致性策略：先更新数据库，再删除缓存

## 8. 系统扩展性设计

为保证系统良好的扩展性，采用以下设计：

1. **模块化设计**：系统按功能划分为多个独立模块，模块间通过接口交互
2. **配置化设计**：系统参数通过配置文件或数据库配置，无需修改代码
3. **抽象接口**：核心功能通过接口定义，具体实现可替换
4. **事件驱动**：关键业务采用事件驱动模式，实现松耦合

## 9. 性能优化策略

系统在以下方面进行了性能优化：

1. **SQL优化**：索引优化、查询优化
2. **缓存优化**：合理使用缓存减少数据库访问
3. **并发控制**：使用乐观锁避免并发冲突
4. **分页查询**：大数据量查询采用分页方式
5. **异步处理**：非核心流程采用异步处理

## 10. 日志与监控

系统采用完善的日志与监控机制：

1. **操作日志**：记录用户关键操作
2. **异常日志**：记录系统异常
3. **性能监控**：监控系统性能指标
4. **告警机制**：异常情况及时告警

## 11. 后续演进方向

系统后续演进计划：

1. **微服务化**：将系统拆分为多个微服务
2. **容器化部署**：使用Docker + Kubernetes进行容器化部署
3. **多端支持**：支持Web、小程序等多端接入
4. **AI智能推荐**：引入AI算法进行内容个性化推荐
5. **社区运营**：完善社区功能，增强用户粘性

## 12. 开发规范

系统开发遵循以下规范：

1. **代码规范**：遵循阿里巴巴Java开发手册
2. **API文档**：所有接口提供Swagger文档
3. **Git工作流**：采用GitFlow工作流
4. **测试覆盖**：核心代码单元测试覆盖率>80%
5. **代码审查**：所有代码提交需通过代码审查 